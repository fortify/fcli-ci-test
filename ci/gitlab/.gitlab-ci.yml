# Expected inputs from trigger:
# VERSION, FCLI_VERSION, PRODUCT, COMPONENT, SOURCE_DIR, OS, FORTIFY_RELEASE, GITLAB_IMAGE (optional), PIPELINE_NAME (optional)

workflow:
  name: $PIPELINE_NAME

# Conditionally include version/component-specific pipelines
include:
  - local: .gitlab-ci-v2-setup.yml
    rules:
      - if: $VERSION == "v2" && $COMPONENT == "setup"
  - local: .gitlab-ci-v2-fod-ast-scan.yml
    rules:
      - if: $VERSION == "v2" && $PRODUCT == "fod" && $COMPONENT == "ast-scan"
  - local: .gitlab-ci-v2-ssc-ast-scan.yml
    rules:
      - if: $VERSION == "v2" && $PRODUCT == "ssc" && $COMPONENT == "ast-scan"
# Fallback job when no variables are set (e.g., direct push)
stages:
  - test

no-op:
  stage: test
  rules:
    - if: $VERSION == null || $COMPONENT == null
    - if: $COMPONENT == "ast-scan" && $PRODUCT != "fod" && $PRODUCT != "ssc"
  script:
    - echo "ERROR Pipeline requires valid trigger variables"
    - echo "VERSION $VERSION"
    - echo "COMPONENT $COMPONENT"
    - echo "PRODUCT $PRODUCT"
    - echo ""
    - echo "This job fails to indicate that no actual test was run."
    - exit 1